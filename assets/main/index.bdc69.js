window.__require=function t(e,o,i){function r(s,c){if(!o[s]){if(!e[s]){var a=s.split("/");if(a=a[a.length-1],!e[a]){var l="function"==typeof __require&&__require;if(!c&&l)return l(a,!0);if(n)return n(a,!0);throw new Error("Cannot find module '"+s+"'")}s=a}var h=o[s]={exports:{}};e[s][0].call(h.exports,function(t){return r(e[s][1][t]||t)},h,h.exports,t,e,o,i)}return o[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<i.length;s++)r(i[s]);return r}({Bomb:[function(t,e,o){"use strict";cc._RF.push(e,"b7386Ne3IpFN5xOvALJIGf3","Bomb");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.Bomb=void 0;var s=t("./Booster"),c=cc._decorator,a=c.ccclass,l=c.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.radius=1,e}return r(e,t),e.prototype.selectTile=function(t){return this.tiles.push(t),0!==this.tiles.length&&this.dispatchAction(),this},e.prototype.dispatchAction=function(){var t=this.tiles[0];this.group=[t];for(var e=-this.radius;e<=this.radius;e++)for(var o=-this.radius;o<=this.radius;o++){var i=t.x+e,r=t.y+o;0===e&&0===o||Math.sqrt(e*e+o*o)<=this.radius&&this.isValidCoordinate(i,r)&&this.group.push(this.grid[i][r])}this.completeBooster()},e.prototype.getResult=function(){return{group:this.group,complete:!1}},n([l(cc.Integer)],e.prototype,"radius",void 0),n([a],e)}(s.Booster);o.Bomb=h,cc._RF.pop()},{"./Booster":"Booster"}],Booster:[function(t,e,o){"use strict";cc._RF.push(e,"da97dbuF4VHH53xYhZEjaP0","Booster");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.Booster=void 0;var s=cc._decorator,c=s.ccclass,a=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.count=5,e.disabled=!1,e.isActive=!1,e.currentCount=0,e.label=null,e.tiles=[],e.grid=null,e.group=[],e}return r(e,t),e.prototype.initBooster=function(){this.isActive=!1,this.disabled=!1,this.currentCount=this.count,this.tiles=[],this.grid=null,this.group=[],this.label=this.node.getChildByName("booster_counter").getComponent(cc.Label),this.label.string=this.currentCount.toString(),this.node.opacity=255},e.prototype.setGrid=function(t){return this.grid=t,this},e.prototype.getGrid=function(){return this.grid},e.prototype.setActive=function(t){return t&&(this.grid=null,this.tiles=[],this.group=[]),this.isActive=t,this.node.opacity=t?150:255,this.playClickAnimation(),this},e.prototype.isValidCoordinate=function(t,e){return t>=0&&t<this.grid.length&&e>=0&&e<this.grid[0].length},e.prototype.completeBooster=function(){this.currentCount--,this.label&&(this.label.string=this.currentCount.toString()),this.currentCount<=0?this.setDisabled():this.setActive(!1)},e.prototype.setDisabled=function(){this.isActive=!1,this.disabled=!0,this.node.opacity=50},e.prototype.playClickAnimation=function(){var t=this.node.scale,e=cc.scaleTo(.1,1.1*t),o=cc.scaleTo(.1,t),i=cc.sequence(e,o);this.node.runAction(i)},e.prototype.selectTile=function(){return this},e.prototype.getResult=function(){return{grid:this.grid,group:this.group,complete:!0}},e.prototype.dispatchAction=function(){},n([a(cc.Integer)],e.prototype,"count",void 0),n([c],e)}(cc.Component);o.Booster=l,cc._RF.pop()},{}],GameController:[function(t,e,o){"use strict";cc._RF.push(e,"8b2dapI2yNCKKtGYH3dtWxH","GameController");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("../Objects/Boosters/Booster"),c=t("../Objects/Tile/Tile"),a=t("../Utils/GridMaster"),l=cc._decorator,h=l.ccclass,p=l.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tilePrefab=null,e.gameArea=null,e.scoreLabel=null,e.movesLabel=null,e.winPanel=null,e.losePanel=null,e.fieldWidth=8,e.fieldHeight=10,e.tileSizeW=50,e.tileSizeH=55,e.targetScore=1e3,e.maxMoves=30,e.tilesCount=5,e.animationDuration=.3,e.connectionCount=2,e.boosters=[],e.activeBooster=null,e.gm=null,e.score=0,e.moves=0,e.gameOver=!1,e}return r(e,t),e.prototype.onLoad=function(){this.initGame()},e.prototype.initGame=function(){var t=this;this.score=0,this.moves=this.maxMoves,this.gameOver=!1,this.gm=new a.GridMaster(this.fieldWidth,this.fieldHeight),this.hideEndGameUI(),this.createGameField(),this.updateUI(),this.activeBooster=null,this.boosters.forEach(function(e){e.getComponent(s.Booster).initBooster(),e.on(cc.Node.EventType.TOUCH_END,t.activateBooster,t)})},e.prototype.activateBooster=function(t){var e,o,i=t.target.getComponent(s.Booster);if(!i.disabled){if((null===(e=this.activeBooster)||void 0===e?void 0:e.isActive)&&i.isActive)return i.setActive(!1),void(this.activeBooster=null);(null===(o=this.activeBooster)||void 0===o?void 0:o.isActive)&&!i.isActive&&this.activeBooster.setActive(!1),this.activeBooster=i,this.activeBooster.setActive(!0)}},e.prototype.hideEndGameUI=function(){this.showLosePanel(!1),this.showWinPanel(!1)},e.prototype.createGameField=function(){this.gameArea.removeAllChildren();for(var t=-(this.fieldWidth-1)*this.tileSizeW/2,e=-(this.fieldHeight-1)*this.tileSizeH/2,o=0;o<this.fieldWidth;o++)for(var i=0;i<this.fieldHeight;i++){var r=this.createTile(o,i,t,e);this.gm.setCell(o,i,r)}},e.prototype.createTile=function(t,e,o,i){var r=cc.instantiate(this.tilePrefab),n=r.getComponent(c.default),s=Math.floor(Math.random()*this.tilesCount),a=o+t*this.tileSizeW,l=i+e*this.tileSizeH;return n.init(t,e,s,this),r.setPosition(a,l),this.gameArea.addChild(r),n},e.prototype.onTileClicked=function(t){var e,o=this;if(!this.gameOver){var i=null;if(null===(e=this.activeBooster)||void 0===e?void 0:e.isActive){var r=this.activeBooster.setGrid(this.gm.getGrid()).selectTile(t).getResult();if((null==r?void 0:r.group)&&(i=r.group),(null==r?void 0:r.grid)&&this.gm.setGrid(r.grid),null==r?void 0:r.complete)return}else i=this.gm.getConnectedCells(t.x,t.y);i.length<=this.connectionCount||(this.burnTiles(i),this.dropTiles(),this.fillEmptySpaces(),this.calculateScore(i.length),this.moves--,this.updateUI(),this.scheduleOnce(function(){o.checkWinCondition(),o.checkGameOver()},2*this.animationDuration))}},e.prototype.burnTiles=function(t){for(var e=this,o=function(t){var o=cc.fadeOut(i.animationDuration),r=cc.scaleTo(i.animationDuration,0),n=cc.spawn(o,r);t.node.runAction(cc.sequence(n,cc.callFunc(function(){t.node.destroy(),e.gm.setCell(t.x,t.y,null)})))},i=this,r=0,n=t;r<n.length;r++)o(n[r])},e.prototype.dropTiles=function(){var t=this;this.scheduleOnce(function(){for(var e=0;e<t.fieldWidth;e++)for(var o=0,i=0;i<t.fieldHeight;i++)if(null!==t.gm.getCell(e,i)){if(o!==i){t.gm.setCell(e,o,t.gm.getCell(e,i)),t.gm.setCell(e,i,null);var r=t.gm.getCell(e,o);r.setCoordinates(e,o),t.animateTileToPosition(r)}o++}},this.animationDuration)},e.prototype.fillEmptySpaces=function(){var t=this;this.scheduleOnce(function(){for(var e=-(t.fieldWidth-1)*t.tileSizeW/2,o=-(t.fieldHeight-1)*t.tileSizeH/2,i=0;i<t.fieldWidth;i++)for(var r=0;r<t.fieldHeight;r++)if(null===t.gm.getCell(i,r)){var n=t.createTile(i,r,e,o);t.gm.setCell(i,r,n),n&&(n.node.setPosition(e+i*t.tileSizeW,o+t.fieldHeight*t.tileSizeH),t.animateTileToPosition(n))}},2*this.animationDuration)},e.prototype.animateTileToPosition=function(t){var e=-(this.fieldHeight-1)*this.tileSizeH/2,o=cc.v2(t.node.position.x,e+t.y*this.tileSizeH),i=cc.moveTo(this.animationDuration,o);t.node.runAction(i)},e.prototype.calculateScore=function(t){var e=10*t*Math.max(1,t-1);this.score+=e},e.prototype.updateUI=function(){this.scoreLabel&&(this.scoreLabel.string=this.score+"/"+this.targetScore),this.movesLabel&&(this.movesLabel.string=this.moves.toString())},e.prototype.checkWinCondition=function(){this.score>=this.targetScore&&(this.gameOver=!0,this.showWinPanel(!0))},e.prototype.checkGameOver=function(){this.gameOver||(!this.gm.hasValidMoves(2)||this.moves<=0)&&(this.gameOver=!0,this.showLosePanel(!0))},e.prototype.showWinPanel=function(t){if(this.winPanel){this.winPanel.active=t;var e=this.winPanel.getChildByName("bg");cc.tween(e).to(1,{opacity:t?200:0}).start()}},e.prototype.showLosePanel=function(t){if(this.losePanel){this.losePanel.active=t;var e=this.losePanel.getChildByName("bg");cc.tween(e).to(1,{opacity:t?200:0}).start()}},e.prototype.restartGame=function(){var t=this;this.boosters.forEach(function(e){e.off(cc.Node.EventType.TOUCH_END,t.activateBooster,t)}),this.initGame()},n([p(cc.Prefab)],e.prototype,"tilePrefab",void 0),n([p(cc.Node)],e.prototype,"gameArea",void 0),n([p(cc.Label)],e.prototype,"scoreLabel",void 0),n([p(cc.Label)],e.prototype,"movesLabel",void 0),n([p(cc.Node)],e.prototype,"winPanel",void 0),n([p(cc.Node)],e.prototype,"losePanel",void 0),n([p(cc.Integer)],e.prototype,"fieldWidth",void 0),n([p(cc.Integer)],e.prototype,"fieldHeight",void 0),n([p(cc.Integer)],e.prototype,"tileSizeW",void 0),n([p(cc.Integer)],e.prototype,"tileSizeH",void 0),n([p(cc.Integer)],e.prototype,"targetScore",void 0),n([p(cc.Integer)],e.prototype,"maxMoves",void 0),n([p(cc.Integer)],e.prototype,"tilesCount",void 0),n([p(cc.Float)],e.prototype,"animationDuration",void 0),n([p(cc.Integer)],e.prototype,"connectionCount",void 0),n([p([cc.Node])],e.prototype,"boosters",void 0),n([h],e)}(cc.Component);o.default=u,cc._RF.pop()},{"../Objects/Boosters/Booster":"Booster","../Objects/Tile/Tile":"Tile","../Utils/GridMaster":"GridMaster"}],GridMaster:[function(t,e,o){"use strict";cc._RF.push(e,"077b8xTIARF6rRGd04Ub99k","GridMaster"),Object.defineProperty(o,"__esModule",{value:!0}),o.GridMaster=void 0;var i=function(){function t(t,e){this.grid=[],this.width=0,this.height=0,this.width=t,this.height=e}return t.prototype.setCell=function(t,e,o){!this.grid[t]&&(this.grid[t]=[]),o&&o.setCoordinates(t,e),this.grid[t][e]=o},t.prototype.getCell=function(t,e){return this.grid[t][e]},t.prototype.getConnectedCells=function(t,e){if(!this.isValidCoordinate(t,e))return[];var o=this.grid[t][e].value,i=new Set;return this._findConnectedGroup(t,e,o,i)},t.prototype._findConnectedGroup=function(t,e,o,i){var r=t+","+e;if(i.has(r))return[];if(!this.isValidCoordinate(t,e))return[];if(this.grid[t][e].value!==o)return[];i.add(r);for(var n=[this.grid[t][e]],s=0,c=[[0,1],[0,-1],[1,0],[-1,0]];s<c.length;s++){var a=c[s],l=a[0],h=a[1],p=this._findConnectedGroup(t+l,e+h,o,i);n=n.concat(p)}return n},t.prototype._fisherYatesShuffle=function(t){for(var e,o=t.length-1;o>0;o--){var i=Math.floor(Math.random()*(o+1));e=[t[i],t[o]],t[o]=e[0],t[i]=e[1]}},t.prototype.swapeTiles=function(t,e){var o=this.grid[t.x][t.y],i=this.grid[e.x][e.y];o.setCoordinates(e.x,e.y),i.setCoordinates(t.x,t.y),this.grid[e.x][e.y]=o,this.grid[t.x][t.y]=i},t.prototype.shuffle=function(t){void 0===t&&(t=5);for(var e=[],o=0;o<this.width;o++)for(var i=0;i<this.height;i++)e.push(this.grid[o][i]);this._fisherYatesShuffle(e);var r=0;for(o=0;o<this.width;o++)for(i=0;i<this.height;i++){var n=e[r++];n.setCoordinates(o,i),this.grid[o][i]=n}!this.hasValidMoves()&&t>0&&this.shuffle(t-1)},t.prototype.getGrid=function(){return this.grid},t.prototype.setGrid=function(t){this.grid=t,this.width=t.length,this.height=t[0].length},t.prototype.isValidCoordinate=function(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height},t.prototype.hasValidMoves=function(t){void 0===t&&(t=1);for(var e=0;e<this.width;e++)for(var o=0;o<this.height;o++)if(null!=this.grid[e][o]){for(var i=0,r=this.grid[e][o].value,n=0,s=[[e+1,o],[e,o+1],[e-1,o],[e,o-1]];n<s.length;n++){var c=s[n],a=c[0],l=c[1];this.isValidCoordinate(a,l)&&this.grid[a][l].value===r&&i++}if(i>=t)return!0}return!1},t}();o.GridMaster=i,cc._RF.pop()},{}],Swape:[function(t,e,o){"use strict";cc._RF.push(e,"2aabdU9yodLSqA1Nd3/KfLS","Swape");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.Swape=void 0;var s=t("./Booster"),c=cc._decorator,a=c.ccclass,l=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.selectTile=function(t){return this.tiles.length<2&&this.tiles.push(t),2===this.tiles.length&&this.dispatchAction(),this},e.prototype.dispatchAction=function(){var t=this.tiles[0],e=this.tiles[1],o=t.x,i=t.y,r=e.x,n=e.y;t.setCoordinates(r,n),e.setCoordinates(o,i),this.grid[o][i]=e,this.grid[r][n]=t,this.tiles=[],cc.tween(t.node).to(.3,{position:e.node.getPosition()},{easing:"backOut"}).start(),cc.tween(e.node).to(.3,{position:t.node.getPosition()},{easing:"backOut"}).start(),this.completeBooster()},e.prototype.getResult=function(){return{grid:this.grid,complete:!0}},n([a],e)}(s.Booster));o.Swape=l,cc._RF.pop()},{"./Booster":"Booster"}],Tile:[function(t,e,o){"use strict";cc._RF.push(e,"f3992EurRNBZZBjvkqpd1hc","Tile");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,a=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.spriteFrames=[],e.x=0,e.y=0,e.value=0,e.gameController=null,e}return r(e,t),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onTileTouch,this)},e.prototype.init=function(t,e,o,i){this.x=t,this.y=e,this.value=o,this.gameController=i,this.getComponent(cc.Sprite).spriteFrame=this.spriteFrames[o]},e.prototype.setCoordinates=function(t,e){this.x=t,this.y=e},e.prototype.onTileTouch=function(){this.gameController&&!this.gameController.gameOver&&(this.playClickAnimation(),this.gameController.onTileClicked(this))},e.prototype.playClickAnimation=function(){var t=cc.scaleTo(.1,1.1),e=cc.scaleTo(.1,1),o=cc.sequence(t,e);this.node.runAction(o)},e.prototype.onDestroy=function(){this.node.off(cc.Node.EventType.TOUCH_END,this.onTileTouch,this)},n([a([cc.SpriteFrame])],e.prototype,"spriteFrames",void 0),n([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{}]},{},["GameController","Bomb","Booster","Swape","Tile","GridMaster"]);